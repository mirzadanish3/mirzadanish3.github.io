<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Office Integrator Save Event Example</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #status {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>Office Document Editor</h1>

  <!-- Iframe containing the Office Integrator document -->
  <iframe
    id="updateIframe"
    src="https://api.office-integrator.com/writer/officeapi/v1/documents/faa2cfe1b69bd6952bee8a1af6fc2001e8361b09eef1f7052729302dd2213ae5ccf1f4d92893d9ebf80c8e7b00bb0083d63321697a2d27db5168656463e04fac1b31457697545c0c8309c5f99d679826be1908c60da9a2e78ea41f8cfe161839/edit"
    width="800"
    height="600"
    frameborder="0">
  </iframe>

  <button onclick="insertContent()">Insert Content on Cursor</button>

  <!-- A status div to show messages -->
  <div id="status">Waiting for save event...</div>

  <script type="text/javascript" src="https://js.zohocdn.com/officeplatform/v1/js/common/xdc-1.0.min.js" crossorigin="anonymous">
  </script>
  <script type="text/javascript">
    document.getElementById("updateIframe").onload = function() {
      console.log(window.location.origin);
      let test = XDC.setTarget({
        "origin": "https://api.office-integrator.com",
        "window": document.getElementById("updateIframe").contentWindow
      });

      test.receiveMessage("DocumentLoadInProgress", function(data) {
        console.log("Document is loading:", data);
      });

      test.receiveMessage("DocumentLoadComplete", function(data) {
        console.log("Document load complete:", data);
        test.postMessage({
          "message": "GetAllNamedRanges",
          "oncomplete": function(data) {
            console.log("Named Ranges Data:", JSON.stringify(data));
          },
          "onexception": function(data) {
            console.error("Error fetching named ranges:", data);
          }
        });
        test.postMessage ( {
              "message": "DocumentStats",
                "oncomplete": function(data) {
                      console.log(JSON.stringify(data));
                      // {
                      // "words": "75",
                      // "characters": "522",
                      // "pages": "1"
                      // }
              },
              "onexception": function(data) {
                      // Handle exception
              }
        } );
      });

      test.receiveMessage("SelectionChanged", function(data) {
        console.log("Selection changed:", data);
      });

     
    };

    function insertContent(){
      XDC.postMessage ( {
        "message": "InsertContent",
        "data": {
            "content": " Happy Writing!",
            "contentType": "text", // or HTML
            "htmlFormat": "SourceFormat", // or DestinationFormat (This data is applicable only when the 'contentType: HTML' and its default value will be 'SourceFormat')
            "scrollIntoView": true
        },
        "oncomplete": function(data) {
                console.log(JSON.stringify(data));
                if (data.result === 1) {
                    // Handle Success
                } else {
                      // Handle Failure
                }
       },
       "onexception": function(data) {
            // Handle exception
       }
} );
    }


  </script>
</body>
</html>
